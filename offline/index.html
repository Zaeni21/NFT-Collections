<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Offline Sonic Enhanced</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: sans-serif; overflow: hidden;
      background: linear-gradient(to bottom, #0a021d, #100530, #000);
    }
    canvas {
      display: block;
    }
    #ui {
      position: absolute;
      top: 20px; left: 20px;
      color: white;
      font-size: 18px;
      z-index: 2;
    }
    #game-over {
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 24px;
      background: rgba(0, 0, 0, 0.6);
      padding: 20px;
      border-radius: 12px;
      display: none;
      z-index: 3;
    }
    #muteBtn {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 2;
      background: rgba(255,255,255,0.1);
      color: white;
      padding: 6px 12px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    #muteBtn:hover {
      background: rgba(255,255,255,0.2);
    }
  </style>
</head>
<body>
  <div id="ui">
    <div>Score: <span id="score">0</span></div>
    <div>Highscore: <span id="highscore">0</span></div>
    <div>Lives: <span id="lives">3</span></div>
  </div>
  <button id="muteBtn" onclick="toggleMusic()">Mute</button>
  <div id="game-over">Game Over!<br><button onclick="restart()">Play Again</button></div>
  <canvas id="game"></canvas>

  <!-- Sounds -->
  <audio id="jumpSound" src="https://freesound.org/data/previews/341/341695_6262466-lq.mp3"></audio>
  <audio id="hitSound" src="https://freesound.org/data/previews/178/178186_3248244-lq.mp3"></audio>
  <audio id="bgMusic" src="https://files.catbox.moe/9s9n8z.mp3" loop autoplay></audio>

  <script>
    const canvas = document.getElementById("game");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const scoreEl = document.getElementById("score");
    const livesEl = document.getElementById("lives");
    const highscoreEl = document.getElementById("highscore");
    const gameOverEl = document.getElementById("game-over");
    const muteBtn = document.getElementById("muteBtn");

    const jumpSound = document.getElementById("jumpSound");
    const hitSound = document.getElementById("hitSound");
    const bgMusic = document.getElementById("bgMusic");

    let score = 0;
    let lives = 3;
    let highscore = localStorage.getItem("sonicHighscore") || 0;
    highscoreEl.textContent = highscore;
    let isMuted = false;

    const sonic = {
      x: 100, y: 0, width: 60, height: 60,
      dy: 0, gravity: 0.8, jumpPower: 14,
      grounded: false, img: null
    };
    sonic.img = new Image();
    sonic.img.src = "https://upload.wikimedia.org/wikipedia/en/thumb/4/43/Sonic_the_Hedgehog.png/220px-Sonic_the_Hedgehog.png";

    const ground = canvas.height - 80;
    let obstacles = [];

    function spawnObstacle() {
      const size = 40 + Math.random() * 40;
      obstacles.push({
        x: canvas.width + Math.random() * 100,
        y: ground - size,
        width: size,
        height: size,
        speed: 6 + Math.random() * 2
      });
    }

    function jump() {
      if (sonic.grounded) {
        sonic.dy = -sonic.jumpPower;
        sonic.grounded = false;
        if (!isMuted) {
          jumpSound.currentTime = 0;
          jumpSound.play();
        }
      }
    }

    function toggleMusic() {
      isMuted = !isMuted;
      bgMusic.muted = isMuted;
      jumpSound.muted = isMuted;
      hitSound.muted = isMuted;
      muteBtn.textContent = isMuted ? "Unmute" : "Mute";
    }

    function drawSonic() {
      ctx.drawImage(sonic.img, sonic.x, sonic.y, sonic.width, sonic.height);
    }

    function drawObstacles() {
      ctx.fillStyle = "#f43f5e";
      for (let ob of obstacles) {
        ctx.fillRect(ob.x, ob.y, ob.width, ob.height);
      }
    }

    function update() {
      if (lives <= 0) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      sonic.dy += sonic.gravity;
      sonic.y += sonic.dy;

      if (sonic.y + sonic.height >= ground) {
        sonic.y = ground - sonic.height;
        sonic.dy = 0;
        sonic.grounded = true;
      }

      for (let ob of obstacles) {
        ob.x -= ob.speed;
      }

      obstacles = obstacles.filter(ob => ob.x + ob.width > 0);

      for (let i = 0; i < obstacles.length; i++) {
        const ob = obstacles[i];
        if (
          sonic.x < ob.x + ob.width &&
          sonic.x + sonic.width > ob.x &&
          sonic.y < ob.y + ob.height &&
          sonic.y + sonic.height > ob.y
        ) {
          obstacles.splice(i, 1);
          lives--;
          livesEl.textContent = lives;
          if (!isMuted) hitSound.play();
          if (lives <= 0) {
            gameOverEl.style.display = "block";
            if (score > highscore) {
              localStorage.setItem("sonicHighscore", score);
              highscoreEl.textContent = score;
            }
            return;
          }
        }
      }

      score++;
      scoreEl.textContent = score;

      drawSonic();
      drawObstacles();
      requestAnimationFrame(update);
    }

    function restart() {
      lives = 3;
      score = 0;
      obstacles = [];
      gameOverEl.style.display = "none";
      livesEl.textContent = lives;
      scoreEl.textContent = score;
      update();
    }

    window.addEventListener("keydown", e => {
      if (e.code === "Space" || e.code === "ArrowUp") jump();
    });
    window.addEventListener("touchstart", jump);
    window.addEventListener("resize", () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });

    sonic.img.onload = () => {
      setInterval(spawnObstacle, 1500);
      update();
    };
  </script>
</body>
</html>
